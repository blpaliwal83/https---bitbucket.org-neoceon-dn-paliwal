/*
 * File: app/view/EventLocation.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('DNB.view.EventLocation', {
    extend: 'Ext.Container',
    alias: 'widget.eventlocation',

    requires: [
        'Ext.Toolbar',
        'Ext.Button',
        'Ext.Spacer',
        'Ext.Map'
    ],

    config: {
        id: 'EventLocation',
        items: [
            {
                xtype: 'toolbar',
                docked: 'top',
                items: [
                    {
                        xtype: 'button',
                        html: 'Back',
                        itemId: 'Back',
                        ui: 'plain',
                        iconCls: 'previousArrowIcon'
                    },
                    {
                        xtype: 'button',
                        itemId: 'ShowDirection',
                        ui: 'plain',
                        text: 'Show Direction',
                        centered:true
                    },
                    {
                        xtype: 'spacer'
                    }
                ]
            }
        ],
        listeners: [
            {
                fn: 'onBackTap',
                event: 'tap',
                delegate: '#Back'
            },
            {
                fn: 'onShowDirectionTap',
                event: 'tap',
                delegate: '#ShowDirection'
            }
        ]
    },

    onBackTap: function(button, e, eOpts) {
        Ext.getCmp('HomeContainer').hide();
        Ext.getCmp('EventLocationMapContainer').hide();
        Ext.getCmp('EventDetailContainer').hide();
        if(mapPageOpenFrom=='Home'){
            Ext.getCmp('HomeContainer').show();
        }else{
            Ext.getCmp('EventDetailContainer').show();
        }
    },

    onShowDirectionTap: function(button, e, eOpts) {
        var lat=0,lon=0;
        var isLocationLocked=false;

        if(isLogin==true && (localStorage.getItem('locationlocked')=='yes')){
            isLocationLocked=true;
            lat=localStorage.getItem('latitude');
            lon=localStorage.getItem('longitude');
        }
        else{
            /*device.getLatLong(function(res){
                //alert(res.lat+'\n'+res.long);
                console.log(res);
                lat =res.lat;
                lon =res.long;
            },function(error){//xlat -= 0;
            });*/
        }
        Ext.getCmp('EventLocation').removeAll();
        Ext.getCmp('EventLocation').add({
            xtype: 'map',
            height: 450,
            itemId:'EventLocationMap'
        });
        //var map=Ext.getCmp('EventLocationMap');
        var map=Ext.getCmp('EventLocation').getComponent('EventLocationMap');
        var geocoder=new google.maps.Geocoder();
        var address=selectedEventDetail.Notice.venu_detail;
        map.setHeight(window.innerHeight-100);

        var directionsService = new google.maps.DirectionsService();

        //alert(address);
        /*geocoder.geocode({address:address},function(results,status){
            if(status== google.maps.GeocoderStatus.OK){
                addr=results[0].geometry.location;
                map.setMapCenter(addr);
                var marker=new google.maps.Marker();
                marker.setMap(map.getMap());
                marker.setPosition(results[0].geometry.location);
                var infoWindow=new google.maps.InfoWindow();
                infoWindow.setContent(address);
                infoWindow.open(map.getMap(),marker);
                var directionsDisplay = new google.maps.DirectionsRenderer();
                var rendererOptions = { map: map };
                //directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);

                directionsDisplay.setMap(map.getMap());
                var request = {
                    //origin:'Indore,Arien Heights Ware House Rd, L I G Colony, In',// new google.maps.LatLng(currentlat, currentlong),
                    //origin: new google.maps.LatLng(22.745293, 75.893003),
                    origin: new google.maps.LatLng(lat,lon),//22.745293, 75.893003),
                    destination:address,//"Indore,C21 MallAgra-Bombay RdNear Malhar Mall, Vijay",// new google.maps.LatLng(lat, latlong),
                    //waypoints: wayPoints8,
                    optimizeWaypoints: true,
                    travelMode: google.maps.DirectionsTravelMode.DRIVING
                };
                directionsService.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        directionsDisplay.setDirections(response);
                    }
                    else {
                        console.log(status);
                    }
                });



            }
        });
        */         
                   var marker=new google.maps.Marker();
                   marker.setMap(map.getMap());
                   // address=selectedEventDetail.Notice.venu_detail;
                   var latlng = new google.maps.LatLng(selectedEventDetail.Notice.latitude, selectedEventDetail.Notice.longitude);
                   var directionsDisplay = new google.maps.DirectionsRenderer();
                   var rendererOptions = { map: map };

                   directionsDisplay.setMap(map.getMap());
                   var request = {
                   //origin:'Indore,Arien Heights Ware House Rd, L I G Colony, In',// new google.maps.LatLng(currentlat, currentlong),
                    // origin: new google.maps.LatLng(31.5497, 74.3436),
                    origin: new google.maps.LatLng(currentLat, currentLong),
                   //origin: new google.maps.LatLng(lat,lon),//22.745293, 75.893003),
                   destination:latlng,//latlng,// new google.maps.LatLng(selectedEventDetail.Notice.latitude,selectedEventDetail.Notice.longitude),//address,//"Indore,C21 MallAgra-Bombay RdNear Malhar Mall, Vijay",// new google.maps.LatLng(lat, latlong),
                   //waypoints: wayPoints8,
                   // optimizeWaypoints: true,
                   travelMode: google.maps.DirectionsTravelMode.DRIVING
                   };
                   directionsService.route(request, function(response, status) {
                       if (status == google.maps.DirectionsStatus.OK) {
                        a = response;
                           console.log(response);
                           directionsDisplay.setDirections(response);
                       }
                       else {
                           console.log(status);
                       }
                   });

                   return;
        return;
        address=selectedEventDetail.Notice.venu_detail+', '+selectedEventDetail.Notice.city+', '+
            selectedEventDetail.Notice.state+', '+selectedEventDetail.Notice.zip;
        var latlng = new google.maps.LatLng(selectedEventDetail.Notice.latitude, selectedEventDetail.Notice.longitude);
        geocoder.geocode({latLng:latlng},function(data,status){

            if(status == google.maps.GeocoderStatus.OK){
                console.log(data);
                //address = data[1].formatted_address; //this is the full address
                addr=data[1].geometry.location;

                map.setMapCenter(addr);
                var marker=new google.maps.Marker();
                marker.setMap(map.getMap());
                marker.setPosition(data[1].geometry.location);
                var infoWindow=new google.maps.InfoWindow();
                infoWindow.setContent(address);
                infoWindow.open(map.getMap(),marker);
                var directionsDisplay = new google.maps.DirectionsRenderer();
                var rendererOptions = { map: map };

                directionsDisplay.setMap(map.getMap());
                var request = {
                    //origin:'Indore,Arien Heights Ware House Rd, L I G Colony, In',// new google.maps.LatLng(currentlat, currentlong),
                    //origin: new google.maps.LatLng(22.745293, 75.893003),
                    origin: new google.maps.LatLng(lat,lon),//22.745293, 75.893003),
                    destination:new google.maps.LatLng(selectedEventDetail.Notice.latitude,selectedEventDetail.Notice.longitude),//address,//"Indore,C21 MallAgra-Bombay RdNear Malhar Mall, Vijay",// new google.maps.LatLng(lat, latlong),
                    //waypoints: wayPoints8,
                    optimizeWaypoints: true,
                    travelMode: google.maps.DirectionsTravelMode.DRIVING
                };
                directionsService.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        console.log(response);
                        directionsDisplay.setDirections(response);
                    }
                    else {
                        console.log(status);
                    }
                });
            }
        });

    }

});